{"version":3,"sources":["../index.js"],"names":["restify","require","botbuilder","server","createServer","listen","process","env","port","PORT","console","log","name","url","connector","ChatConnector","appId","APP_ID","appPassword","APP_SECRET","post","bot","UniversalBot","session","beginDialog","userData","profile","results","response","send","company","dialog","args","next","dialogData","Prompts","text","endDialogWithResult"],"mappings":";;AAAA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,aAAaD,QAAQ,YAAR,CAAjB;;AAEA;AACA,IAAIE,SAASH,QAAQI,YAAR,EAAb;AACAD,OAAOE,MAAP,CAAcC,QAAQC,GAAR,CAAYC,IAAZ,IAAoBF,QAAQC,GAAR,CAAYE,IAAhC,IAAwC,IAAtD,EAA4D,YAAY;AACpEC,YAAQC,GAAR,CAAY,sBAAZ,EAAoCR,OAAOS,IAA3C,EAAiDT,OAAOU,GAAxD;AACH,CAFD;;AAIA;AACA,IAAIC,YAAY,IAAIZ,WAAWa,aAAf,CAA6B;AACzCC,WAAOV,QAAQC,GAAR,CAAYU,MADsB;AAEzCC,iBAAaZ,QAAQC,GAAR,CAAYY;AAFgB,CAA7B,CAAhB;;AAKA;AACAhB,OAAOiB,IAAP,CAAY,eAAZ,EAA6BN,UAAUT,MAAV,EAA7B;;AAEA;AACA,IAAIgB,MAAM,IAAInB,WAAWoB,YAAf,CAA4BR,SAA5B,EAAuC,CAC7C,UAAUS,OAAV,EAAmB;AACfA,YAAQC,WAAR,CAAoB,eAApB,EAAqCD,QAAQE,QAAR,CAAiBC,OAAtD;AACH,CAH4C,EAI7C,UAAUH,OAAV,EAAmBI,OAAnB,EAA4B;AACxBJ,YAAQE,QAAR,CAAiBC,OAAjB,GAA2BC,QAAQC,QAAnC,CADwB,CACqB;AAC7CL,YAAQM,IAAR,YAAsBN,QAAQE,QAAR,CAAiBC,OAAjB,CAAyBd,IAA/C,iBAA+DW,QAAQE,QAAR,CAAiBC,OAAjB,CAAyBI,OAAxF;AACH,CAP4C,CAAvC,CAAV;;AAUAT,IAAIU,MAAJ,CAAW,eAAX,EAA4B,CACxB,UAAUR,OAAV,EAAmBS,IAAnB,EAAyBC,IAAzB,EAA+B;AAC3BV,YAAQW,UAAR,CAAmBR,OAAnB,GAA6BM,QAAQ,EAArC,CAD2B,CACc;AACzC,QAAI,CAACT,QAAQW,UAAR,CAAmBR,OAAnB,CAA2Bd,IAAhC,EAAsC;AAClCV,mBAAWiC,OAAX,CAAmBC,IAAnB,CAAwBb,OAAxB,EAAiC,mBAAjC;AACH,KAFD,MAEO;AACHU,eADG,CACK;AACX;AACJ,CARuB,EASxB,UAAUV,OAAV,EAAmBI,OAAnB,EAA4BM,IAA5B,EAAkC;AAC9B,QAAIN,QAAQC,QAAZ,EAAsB;AAClB;AACAL,gBAAQW,UAAR,CAAmBR,OAAnB,CAA2Bd,IAA3B,GAAkCe,QAAQC,QAA1C;AACH;AACD,QAAI,CAACL,QAAQW,UAAR,CAAmBR,OAAnB,CAA2BI,OAAhC,EAAyC;AACrC5B,mBAAWiC,OAAX,CAAmBC,IAAnB,CAAwBb,OAAxB,EAAiC,+BAAjC;AACH,KAFD,MAEO;AACHU,eADG,CACK;AACX;AACJ,CAnBuB,EAoBxB,UAAUV,OAAV,EAAmBI,OAAnB,EAA4B;AACxB,QAAIA,QAAQC,QAAZ,EAAsB;AAClB;AACAL,gBAAQW,UAAR,CAAmBR,OAAnB,CAA2BI,OAA3B,GAAqCH,QAAQC,QAA7C;AACH;AACDL,YAAQc,mBAAR,CAA4B,EAAET,UAAUL,QAAQW,UAAR,CAAmBR,OAA/B,EAA5B;AACH,CA1BuB,CAA5B","file":"index.js","sourcesContent":["let restify = require('restify')\nlet botbuilder = require('botbuilder')\n\n// setup the restify server\nlet server = restify.createServer()\nserver.listen(process.env.port || process.env.PORT || 3987, function () {\n    console.log('%s bot started at %s', server.name, server.url);\n})\n\n// create chat connector\nlet connector = new botbuilder.ChatConnector({\n    appId: process.env.APP_ID,\n    appPassword: process.env.APP_SECRET\n})\n\n// Listening for user inputs\nserver.post('/api/messages', connector.listen())\n\n// This bot ensures user's profile is up to date.\nvar bot = new botbuilder.UniversalBot(connector, [\n    function (session) {\n        session.beginDialog('ensureProfile', session.userData.profile);\n    },\n    function (session, results) {\n        session.userData.profile = results.response; // Save user profile.\n        session.send(`Hello ${session.userData.profile.name}! I love ${session.userData.profile.company}!`);\n    }\n]);\n\nbot.dialog('ensureProfile', [\n    function (session, args, next) {\n        session.dialogData.profile = args || {}; // Set the profile or create the object.\n        if (!session.dialogData.profile.name) {\n            botbuilder.Prompts.text(session, \"What's your name?\");\n        } else {\n            next(); // Skip if we already have this info.\n        }\n    },\n    function (session, results, next) {\n        if (results.response) {\n            // Save user's name if we asked for it.\n            session.dialogData.profile.name = results.response;\n        }\n        if (!session.dialogData.profile.company) {\n            botbuilder.Prompts.text(session, \"What company do you work for?\");\n        } else {\n            next(); // Skip if we already have this info.\n        }\n    },\n    function (session, results) {\n        if (results.response) {\n            // Save company name if we asked for it.\n            session.dialogData.profile.company = results.response;\n        }\n        session.endDialogWithResult({ response: session.dialogData.profile });\n    }\n]);"]}